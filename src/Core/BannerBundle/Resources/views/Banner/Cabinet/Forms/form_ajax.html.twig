{#редактирование баннера в ЛК#}
{#
{% extends "ApplicationSonataUserBundle::cabinet_layout.html.twig" %}

{% block sub_content %}
#}

{% set errorForm = null %}
{% if imageForm.vars.errors | length %}
    {% set errorForm = 'imageForm' %}
{% elseif  codeForm.vars.errors | length %}
    {% set errorForm = 'codeForm' %}
{% elseif   flashForm.vars.errors | length %}
    {% set errorForm = 'flashForm' %}
{% endif %}

<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="responsive" class="modal fade" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel">Добавление банера</h4>
                <div class="modal-content-wr">
                    <form id="form_image" class="{% if errorForm and (errorForm != 'imageForm') %} hidden{% endif %} trigger sky-form sky-form-other-style"action="{{ path('core_cabinet_banner_create_ajax') }}" {{ form_enctype(imageForm) }}
                          method="POST">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <fieldset class="sky-form-other-style">

                                        {% for child in imageForm.children %}
                                        <div class="row margin-bottom-20">
                                            <div class="col-sm-12  {% if form_errors(child) %}state-error{% endif %}">
                                                {% set  curClass = 'form-control'  %}
                                                {% if child.vars.attr.class is defined %}
                                                    {%  set curClass = child.vars.attr.class ~ ' ' ~ curClass  %}
                                                {% endif  %}

                                                {% if child.vars.name ==  'isOpenUrlInNewWindow' %}
                                                    <label class="checkbox">
                                                        {{ form_widget(child) }}<i></i> {{ child.vars.label }}{% if child.vars.required %} *{%  endif %}</label>
                                                    {{ form_errors(child) }}
                                                    </label>
                                                {% else %}
                                                    <label>{{ child.vars.label }}{% if child.vars.required %} *{%  endif %}</label>
                                                    {{ form_widget(child,{ 'attr': {'class': curClass} }) }}
                                                    {{ form_errors(child) }}
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                        <div class=" margin-bottom-20">
                                        </div>

                                        {{ form_rest(imageForm) }}

                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-u btn-u-default" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn-u btn-u-primary">Сохранить</button>
                        </div>
                    </form>

                    <form id="form_code" class="trigger{% if not (errorForm == 'codeForm') %} hidden{% endif %} sky-form sky-form-other-style"action="{{ path('core_cabinet_banner_create_ajax') }}" {{ form_enctype(codeForm) }}
                          method="POST">
                        <div class="modal-body">
                            {% if codeForm.vars.errors | length %}
                                <br/>
                                <div class="alert alert-danger fade in">
                                    {{ form_errors(codeForm) }}
                                </div>
                            {% endif %}

                            <div class="row">
                                <div class="col-md-12">
                                    <fieldset class="sky-form-other-style">

                                        {% for child in codeForm.children %}
                                            {% set  curClass = 'form-control'  %}
                                            {% if child.vars.attr.class is defined %}
                                                {%  set curClass = child.vars.attr.class ~ ' ' ~ curClass  %}
                                            {% endif  %}

                                            <div class="row margin-bottom-20">
                                                <div class="col-sm-12  {% if form_errors(child) %}state-error{% endif %}">
                                                    <label>{{ child.vars.label }}{% if child.vars.required %} *{%  endif %}</label>
                                                    {{ form_widget(child,{ 'attr': {'class': curClass} }) }}
                                                    {{ form_errors(child) }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class=" margin-bottom-20">
                                        </div>

                                        {{ form_rest(codeForm) }}

                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-u btn-u-default" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn-u btn-u-primary">Сохранить</button>
                        </div>
                    </form>

                    <form id="form_flash" class="trigger{% if not (errorForm == 'flashForm') %} hidden {% endif %} sky-form sky-form-other-style"action="{{ path('core_cabinet_banner_create_ajax') }}" {{ form_enctype(flashForm) }}
                          method="POST">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <fieldset class="sky-form-other-style">

                                        {% for child in flashForm.children %}
                                            {% set  curClass = 'form-control'  %}
                                            {% if child.vars.attr.class is defined %}
                                                {%  set curClass = child.vars.attr.class ~ ' ' ~ curClass  %}
                                            {% endif  %}
                                            <div class="row margin-bottom-20">
                                                <div class="col-sm-12  {% if form_errors(child) %}state-error{% endif %}">
                                                    <label>{{ child.vars.label }}{% if child.vars.required %} *{%  endif %}</label>
                                                    {{ form_widget(child,{ 'attr': {'class': curClass} }) }}
                                                    {{ form_errors(child) }}
                                                    {% if  child.vars.note is defined %}
                                                        <span class="note">{{ child.vars.note | raw }}</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class=" margin-bottom-20">
                                        </div>

                                        {{ form_rest(flashForm) }}

                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-u btn-u-default" data-dismiss="modal">Отмена</button>
                            <button type="submit" class="btn-u btn-u-primary">Сохранить</button>
                        </div>
                    </form>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    (function($){

        $(function(){

            // видимость формы
            $('body').on('change', '.banner_type', function(){
                var $this = $(this),
                    formId = 'form_' + $this.val(),
                    curForm = $('#'+formId),
                    same = $('.banner_type'),
                    forms = $('.trigger');
                same.each(function(index, element){
                    $(element).val($this.val());
                });
                forms.each(function(index, element){
                    var $this = $(element);
                        $this.addClass('hidden');
                        curForm.hide();
                });

                if (curForm.hasClass('hidden')) {
                    curForm.removeClass('hidden');
                    curForm.show();
                }
            });


            $('body').on('submit', '.trigger', function() {
                var $this = $(this),
                    collectionWrapper = $('.collection-wrapper'),
                    collectionCount = $('.collection-row').length,
                    newWidget = $('.collection-add').attr('data-prototype'),
                    answerPlacement = $('.modal-content-wr'),
                    newWidget = newWidget.replace(/__name__/g, collectionCount),
                    modalBlock = $('#responsive');
                $.ajax({
                    type: 'POST',
                    url: "{{ path('core_cabinet_banner_create_ajax') }}",
                    data: $this.serialize(),
                    success: function(data) {
                        if (data.result) {
                            modalBlock.modal('hide');
                            collectionWrapper.append(newWidget);
                        } else {
                            answerPlacement.html($('.modal-content-wr', data.data).html());
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });

                return false;
            });
        });



    })(jQuery)
</script>

{#{% endblock %}#}
