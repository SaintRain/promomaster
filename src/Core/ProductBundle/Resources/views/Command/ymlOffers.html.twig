{%spaceless%}
    {%for p in products%}
        <offer id="{{p.id}}" type="vendor.model" available="{%if p.orderOnly%}false{%else%}true{%endif%}">
            <url>http://{{ domain_ru }}{{path('core_product', {slug:p.slug})}}</url>
            <price>{{p.price}}</price>
            <currencyId>RUB</currencyId>
            <categoryId>{{p.categoryMain.id}}</categoryId>
                {%if p.images%}
                    {%set sliceCount=9%}
                <picture>http://{{ domain_ru }}{%if p.images|getFileWebPath%}{{ asset(p.images|getFileWebPath('watermark','watermark_')) }}{%endif%}</picture>
                {%else%}
                    {%set sliceCount=10%}
                {%endif%}
                {%for img in p.images|slice(0, sliceCount) %}
                    {#     {% if loop.index<9 %}#}
                <picture>http://{{ domain_ru }}{%if img|getFileWebPath%}{{ asset(img|getFileWebPath('watermark','watermark_')) }}{%endif%}</picture>
                    {# {%endif%}#}
                {%endfor%}
            <delivery>{%if p.IsPhysical %}true{%else%}false{%endif%}</delivery>
            <local_delivery_cost>{%if p.IsPhysical %}300{%else%}0{%endif%}</local_delivery_cost>
            <typePrefix>{{p.typePrefix}}</typePrefix>
            <vendor>{%if p.manufacturerMain%}{{p.manufacturerMain.captionRu}}{%else%}{%endif%}</vendor>
            <vendorCode>{{p.sku}}</vendorCode>
            <model>{% if p.ymlCaption %}{{p.ymlCaption}}{% else %}{{p.captionRu}}{% endif %}</model>
            <description>{{p.shortDescriptionRu}}</description>
            <sales_notes>100% предоплата или наложенный платеж.</sales_notes>
            <manufacturer_warranty>

                {%- if p.warrantyMonths -%}

                {%- set years = p.warrantyMonths // 12 -%}
                {%- set months = p.warrantyMonths % 12 -%}

                {%- if years > 0 or months > 0 -%}
                P
                {%- endif -%}

                {%- if years > 0 -%}
                {{- years -}}Y
                {%- endif -%}

                {%- if months > 0 -%}
                {{- months -}}M
                {%- endif -%}

                {%- else -%}
                false
                {%- endif -%}

            </manufacturer_warranty>
            <country_of_origin>{%if p.countryOfOrigin %}{{p.countryOfOrigin.captionRu}}{%else%}{%endif%}</country_of_origin>
                {%set isProcessed=[]%}
                {%for pdp in p.productDataProperty%}
                    {% if pdp.data.property.name not in ['sex','age', 'toy_property']|keys and pdp.data.property.isEnabledInYml %}
                        {%if pdp.data.property.editType=='input'%}
                        <param name="{{pdp.data.property.captionRu}}" {%if pdp.data.property.defaultUnit%}unit="{{pdp.data.property.defaultUnit.shortCaptionRu}}"{%endif%}>{{pdp.valueNumeric}}</param>
                    {%endif%}
                    {%if pdp.data.property.editType=='input_text'%}
                        <param name="{{pdp.data.property.captionRu}}">{{pdp.value}}</param>
                    {%endif%}
                    {%if pdp.data.property.editType=='select'%}
                        <param name="{{pdp.data.property.captionRu}}">{{pdp.data.value}}</param>
                    {%endif%}
                    {%if pdp.data.property.editType=='radio'%}
                        <param name="{{pdp.data.property.captionRu}}">{{pdp.data.value}}</param>
                    {%endif%}
                    {%if pdp.data.property.editType=='checkbox'%}
                        <param name="{{pdp.data.property.captionRu}}">{{pdp.data.value}}</param>
                    {%endif%}
                    {%if pdp.data.property.editType=='multiselect' and pdp.data.property.name not in isProcessed%}
                        {% set isProcessed = isProcessed|merge([pdp.data.property.name]) %}
                        <param name="{{pdp.data.property.captionRu}}">{{p.multiselectDataToStr[pdp.data.property.name]|join(', ')}}</param>
                    {%endif%}
                {%endif%}
            {%endfor%}

            {# серия #}
            {% if p.serie.captionRu is defined %}
                <param name="Линейка">{{p.serie.captionRu}}</param>
            {%endif%}
            {# пол #}

            {%for pdp in p.productDataProperty%}
                {% if pdp.data.property.name=='sex' and pdp.data.property.isEnabledInYml %}
                    <param name="Пол">{%if pdp.data.name=='boy' %}Женский{%else%}Мужской{%endif%}</param>
                {%endif%}
            {%endfor%}

            {#высчитавыем для какого возраста#}
            {%set age=p.getPDPByPropertyName('age')%}
            {%if age.data is defined and age.data.property.isEnabledInYml%}
                {%set fromTo=age.data.value|split('-')%}
                <param name="Возраст от" unit="лет">{{fromTo[0]}}</param>
                <param name="Возраст до" unit="лет">{{fromTo[1]}}</param>
            {%endif%}
            {#Свойство игрушки#}
            {%for pdp in p.productDataProperty%}
                {% if pdp.data.property.name =='toy_property' %}
                    <param name="Свойство игрушки">{{pdp.data.value}}</param>
                {%endif%}
            {%endfor%}

            {#Габариты#}
            {%if p.widthOfProduct%}
                <param name="Ширина" unit="см">{{(p.widthOfProduct/10)|round}}</param>
            {%endif%}

            {%if p.heightOfProduct%}
                <param name="Высота" unit="см">{{(p.heightOfProduct/10)|round}}</param>
            {%endif%}

            {%if p.lengthOfProduct%}
                <param name="Длина" unit="см">{{(p.lengthOfProduct/10)|round}}</param>
            {%endif%}
            {%if p.netWeight%}
                <param name="Вес" unit="кг">{%if p.isNetWeightInGm%}{{(p.netWeight/1000)|round(4, 'floor') }}{%else%}{{p.netWeight}}{%endif%}</param>
            {%endif%}
        </offer>
    {%endfor%}
{%endspaceless%}