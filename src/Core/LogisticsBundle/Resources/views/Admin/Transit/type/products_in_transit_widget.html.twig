{% block products_in_transit_widget %}
{%if inTransit%}
<table class="table table-striped table-bordered">
    <thead>
    <th>Продукт</th>
    <th>Из заказа</th>
    <th>Всего</th>
</thead>
<tbody>
{% for t in inTransit%}
        <tr>
    <td><a href="{{path('admin_core_product_commonproduct_edit', {id:t.product.id})}}"><b>{{t.product.sku}}</b> {{t.product.captionRu}}</a></td>
    <td>
    {% for book in t.booking%}
            <p id="book_content{{book.id}}"><a href="{{path('admin_core_order_order_edit', {id:book.composition.order.id})}}">Заказ №{{book.composition.order.id}}, {{book.quantity}} шт.</a>

{%if not sonata_admin.admin.subject.status or  (sonata_admin.admin.subject.status.name!='v-puti' and not sonata_admin.admin.subject.isTransitWasExecuted) %}
                <a title="Удалить из транзита" class="booking-remove" data-product="{{t.product.id}}" data-book="{{book.id}}" href="javascript:void(0);"><i class="icon-remove"></i></a>
{%endif%}
                </p>
    {% endfor%}
            </td>
            <td id="book_total{{t.product.id}}">{{t.total}} шт.</td>
            </tr>
{% endfor%}
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            //удаление из транзита
            $('a.booking-remove').click(function() {
                var r = confirm("Вы действительно хотите удалить из транзита эти товарные позиции?");
                if (r) {
                    var d_id = $(this).attr('data-book'),
                            p_id = $(this).attr('data-product');


                    $.ajax({
                        url: "{{path('core_logistics_delete_book_from_transit')}}",
                        data: {id: d_id},
                        success: function(data) {
                            console.log(data);

                            $('#book_total' + p_id).html(data.total + ' шт.');
                            $('#book_content' + d_id).remove();
                        }
                        //dataType: 'GET'
                    });
                }
            })
        })
        </script>
{%else%}
        В транзите нет товара...
{%endif%}
{%endblock%}