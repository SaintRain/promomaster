(function(a){a(function(){var c=a(".delivery_companies .hidden .delivery_company").length-1;a(".delivery_companies .hidden .delivery_company").each(function(d,e){var g=a(e),f=(c==d)?true:false;b(g,f,false)});a(".delivery_all").click(function(){var d=a(this),e=a(".delivery_company.done");if(d.hasClass("to_hide")){d.removeClass("to_hide").text(settingsJS.trans.delivery_calculate_show);e.each(function(g,i){var j=a(i),f=j.parent("dt"),h=f.next("dd");if(g!=0){f.hide();h.hide()}})}else{d.addClass("to_hide").text(settingsJS.trans.delivery_calculate_hide);a(".delivery_companies .hidden .delivery_company").each(function(g,i){var j=a(i),f=j.parent("dt"),h=f.next("dd");if(j.hasClass("done")){f.show();h.show()}else{b(j,false,true)}})}})});var b=function(f,e,d){var j=a(".delivery_all"),i,l=f,c=l.parents(".product_buy_delivery"),g=l.parent("dt"),h=g.next("dd"),k=a("span",h);a.ajax({method:"POST",url:settingsJS.routes.delivery_calculate,data:"productId="+c.data("product-id")+"&deliveryMethodId="+l.data("delivery")+"&deliveryCityId="+l.data("user-city")+"&productPrice="+c.data("product-price"),success:function(m){if(m.result.cost){l.addClass("done");k.text(m.result.days.maxDaysTrans);if(d){g.show();h.show()}}else{h.text(" "+settingsJS.trans.delivery_broken_connection)}if(a(".delivery_company.done").length&&e){i=a(".delivery_company.done:first");i.parent("dt").show();i.parent("dt").next("dd").show();a(".delivery_all").show()}}})}})(jQuery);