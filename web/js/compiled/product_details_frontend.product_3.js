function first(c){for(var b in c){return b}}var speedAnimation=200;$(function(){$("#color").change(function(){var l=$("#size :selected").val();var k=$("#color :selected").data("links-json");var j;if(undefined!==k){if(undefined!==k[l]){j=location.origin+k[l]}else{j=location.origin+k[first(k)]}location.href=j}});var e=$("#sizeMsgTpl").html();$("#size").change(function(){if($(this).hasClass("load")){$("#size").val($('#size option[data-current="this"]').val())}$(this).removeClass("load");var n=$("#size :selected").val();var l=$("#size :selected").text();var m=$("#color :selected").text();var k=$("#color :selected").data("links-json");if(undefined===k||undefined===k[n]){var j=new Array();$("#color option").each(function(){var o=$(this).data("links-json");if(undefined!==o&&undefined!==o[n]){j[j.length]=" - "+$(this).text()}});if(j.length){sizeMsg=e.replace(/%size%/g,l).replace(/%color%/g,m).replace(/%colors%/g,j.join(";<br>"));$("#sizeMsgTpl").html(sizeMsg).slideDown("fast")}$(".instock").removeClass("instock").addClass("not_instock");$(".button_cart").prop("disabled",true).fadeOut(100)}else{if(undefined!==k[n]&&location.origin+k[n]!==location.href.replace(/#.+/,"")){}else{$(".button_cart").prop("disabled",false).fadeIn(100)}$("#sizeMsgTpl").slideUp("fast");$(".not_instock").removeClass("not_instock").addClass("instock")}}).trigger("change");$(".fancybox-button").fancybox({prevEffect:"fade",openEffect:"fade",closeEffect:"fade",nextEffect:"fade",transitionIn:"elastic",transitionOut:"elastic",iframe:{preload:false},nextMethod:"resizeIn"});var g={widthItem:$(".product_gallery_item").width()+parseInt($(".product_gallery_item").css("margin-left"))*2+parseInt($(".product_gallery_item").css("border-width"))*2,count:$(".product_gallery_item").size(),boundWidth:$(".product_gallery").width()};g.widthContainer=g.widthItem*g.count;$(".product_gallery_scroll").width(g.widthContainer);if(g.widthContainer>g.boundWidth){$(".product_gallery_nav.next").removeClass("disabled")}$(".product_gallery_nav").disableSelection();$(".product_gallery_nav.next").click(function(){var k=$(this);if(k.hasClass("disabled")||k.hasClass("busy")){return false}k.addClass("busy");var j=$(".product_gallery_scroll");j.animate({marginLeft:-g.widthItem+parseInt(j.css("margin-left"))},speedAnimation,"linear",function(){if($(".product_gallery_nav.prev").hasClass("disabled")){$(".product_gallery_nav.prev").removeClass("disabled")}if(Math.abs(parseInt(j.css("margin-left")))>=Math.abs(g.widthContainer-g.boundWidth)){k.addClass("disabled")}k.removeClass("busy")})});$(".product_gallery_nav.prev").click(function(){var k=$(this);if(k.hasClass("disabled")||k.hasClass("busy")){return false}k.addClass("busy");var j=$(".product_gallery_scroll");j.animate({marginLeft:g.widthItem+parseInt(j.css("margin-left"))},speedAnimation,"linear",function(){if($(".product_gallery_nav.next").hasClass("disabled")){$(".product_gallery_nav.next").removeClass("disabled")}if(parseInt(j.css("margin-left"))>=0){k.addClass("disabled")}k.removeClass("busy")})});$(".product_gallery_item").mouseover(function(){$(".product_gallery_item").removeClass("active");$(this).addClass("active");var j=$(this).data("src");$(".product_photo_view img").prop("src",j)});$(".product_photo_view img").click(function(){if($(".product_gallery_item.active a").length){$(".product_gallery_item.active a").trigger("click")}});$(".product_photo_view .loupe").click(function(){$(this).parent(".product_photo_view").find("img").trigger("click")});$(".zoom-photo span").click(function(){$(this).parent(".zoom-photo").prev(".product_photo_view").find("img").trigger("click")});$(".showcase_compact_nav").disableSelection();$(".showcase_nav").disableSelection();var c=new Array();var i=new Array();var d=new Array();$(".showcase_compact_box, .showcase_container").each(function(n){var q=$(this);var l=q.find(".products_grid_line");var p=l.find(".product");var k=q.find(".showcase_compact_nav.next").size()?q.find(".showcase_compact_nav.next"):q.find(".showcase_nav.next");var m=q.find(".showcase_compact_nav.prev").size()?q.find(".showcase_compact_nav.prev"):q.find(".showcase_nav.prev");var o=Math.round(l.width()/p.outerWidth());d[n]=232;if(q.hasClass("showcase_compact_box")){var j=q.find(".grid_container")}else{var j=q}j.find(".product").each(function(){$(this).find("img")[0].onload=function(){h=$(this).closest("div.product").outerHeight();if(h>d[n]){j.css("min-height",h+"px");j.find(".grid_container").css("min-height",h+"px")}}});c[n]=1;i[n]=o+c[n];if(p.size()>o){k.removeClass("disabled");p.each(function(r){if(r>(o-1)){$(this).hide()}})}k.click(function(){if(k.hasClass("disabled")||k.hasClass("busy")||(i[n]>=p.size()+1)){return false}k.addClass("busy");$right=l.find(".product:nth-child("+i[n]+")").css({position:"absolute",top:parseInt(p.css("margin-top")),left:parseInt(l.width())}).show();$right.animate({left:parseInt($right.css("left"))-p.outerWidth()},speedAnimation,"linear",function(){});$left=l.find(".product:nth-child("+c[n]+")").animate({marginLeft:-p.outerWidth()},speedAnimation,"linear",function(){if(m.hasClass("disabled")){m.removeClass("disabled")}if(i[n]>=p.size()+1){k.addClass("disabled")}$right.removeAttr("style");$(this).hide();k.removeClass("busy")});c[n]++;i[n]++});m.click(function(){if(m.hasClass("disabled")||m.hasClass("busy")||c[n]<=0){return false}m.addClass("busy");$left=l.find(".product:nth-child("+(c[n]-1)+")").css({marginLeft:-parseInt(p.outerWidth())}).show();$right=l.find(".product:nth-child("+(i[n]-1)+")").css({position:"absolute",top:parseInt(p.css("margin-top")),left:parseInt(p.outerWidth()*(o-1))}).show();$left.animate({marginLeft:0},speedAnimation,"linear",function(){});$right=l.find(".product:nth-child("+(i[n]-1)+")").animate({left:parseInt(l.width())},speedAnimation,"linear",function(){if(k.hasClass("disabled")){k.removeClass("disabled")}if((c[n]-1)<=0){m.addClass("disabled")}$left.removeAttr("style");$(this).hide();m.removeClass("busy")});c[n]--;i[n]--})});var f={add:{url:$("#update-favorite").data("add-url"),text:$("#update-favorite").data("add-text")},remove:{url:$("#update-favorite").data("remove-url"),text:$("#update-favorite").data("remove-text")},isInFavorite:$("#update-favorite").data("is-in-favorite"),isLogged:$("#update-favorite").data("is-logged")};if(f.isInFavorite){$("#update-favorite").text(f.remove.text).addClass("remove_from_faver")}else{$("#update-favorite").text(f.add.text)}$("#update-favorite").click(function(){if($(this).hasClass("busy")){return}$(this).addClass("busy");f.isInFavorite=$("#update-favorite").data("is-in-favorite");if(!f.isLogged){$(".modal_window").addClass("modal-in-center").modal("show");setCookie("add_in_favorite",f.add.url,{expires:3600*24});setCookie("redirect",document.URL,{expires:3600*24});$("#update-favorite").removeClass("busy");return}var j=f.isInFavorite?f.remove.url:f.add.url;var k=$(".ajax-result-favorites");k.children("div").slideUp("fast");$.ajax({type:"POST",url:j}).done(function(l){if(undefined!==l.success){$("#update-favorite").data("is-in-favorite",f.isInFavorite?0:1);$("#update-favorite").text(f.isInFavorite?f.add.text:f.remove.text);if(f.isInFavorite){$("#update-favorite").removeClass("remove_from_faver")}else{$("#update-favorite").addClass("remove_from_faver")}k.find(".ajax-success").html(l.success.join("<br>")).slideDown("fast")}if(undefined!==l.error){$("#update-favorite").data("is-in-favorite",f.isInFavorite?0:1);$("#update-favorite").text(f.isInFavorite?f.add.text:f.remove.text);k.find(".ajax-error").html(l.error.join("<br>")).slideDown("fast")}$("#update-favorite").removeClass("busy")})});if(getCookie("add_in_favorite")!==undefined){if(!f.isInFavorite){$('span[data-add-url="'+getCookie("add_in_favorite")+'"]').trigger("click")}deleteCookie("add_in_favorite")}var b={id:$("#update-cart").data("id"),url:$("#update-cart").data("url"),isInCart:$("#update-cart").data("is-in-cart"),isInCartText:$("#update-cart").data("is-in-cart-text")};var a=$.parseJSON(orderJsonString)||{};if($("#quantity-alternative").length){$("#quantity-alternative").on("change",function(){var j=parseInt($("#quantity-alternative").val());if(a!==null&&a.products!==undefined&&a.products[j]!==undefined){$(".ajax-result-cart").find(".ajax-success").html(b.isInCartText).slideDown("fast")}else{$(".ajax-result-cart").find(".ajax-success").slideUp("fast")}})}$("#update-cart").on("click",function(){if($(this).hasClass("disabled")){return}$(this).addClass("disabled");b.action="add";if($("#quantity-alternative").length){b.id=parseInt($("#quantity-alternative").val())}var j=$(".ajax-result-cart");j.children("div").slideUp("fast");$.ajax({type:"POST",data:{id:b.id,action:b.action},url:b.url}).done(function(k){if(undefined!==k.success){j.find(".ajax-success").html(k.success.join("<br>")).slideDown("fast");if(a!==null&&a.products!==undefined&&a.products[b.id]!==undefined){a.products[b.id]["quantity"]+=1}else{a.products=new Array();a.products[b.id]={id:b.id,quantity:1}}}if(undefined!==k.error){j.find(".ajax-error").html(k.error.join("<br>")).slideDown("fast")}if(undefined!==k.data){$(".header_usercart_count").text(k.data.total_quantity);$(".header_usercart_info").text(declOfNum(k.data.total_quantity,["товар","товара","товаров"])+", "+number_format(k.data.total_cost)+" "+$(".header_usercart_info").data("currency"))}$("#update-cart").removeClass("disabled")})});$("#buy-in-order").on("click",function(){if($(this).hasClass("disabled")){return}$(this).addClass("disabled");var j=$(this).closest("form");var k={email:j.find('input[name="email"]').val(),phone:j.find('input[name="phone"]').val(),id:j.find('input[name="id"]').val()};console.log();if(!k.email.length||k.email.indexOf("@")<1){$("#byOrderMessage").show().attr("class","by-order-error-message").html("Поле email является обязательным!");$(this).removeClass("disabled");return false}$.ajax({type:"POST",data:k,url:settingsJS.routes.core_product_buy_by_order}).done(function(l){if(undefined!==l.success){j.find('input[name="email"]').val("");j.find('input[name="phone"]').val("");$("#byOrderMessage").show().attr("class","by-order-success-message").html(l.success.join("<br>"))}else{$("#byOrderMessage").show().attr("class","by-order-error-message").html("Произошла ошибка!")}$("#buy-in-order").removeClass("disabled")});return false})});(function(b,a){a.transitions.resizeIn=function(){var e=a.previous,f=a.current,d=e.wrap.stop(true).position(),c=b.extend({opacity:1},f.pos);d.width=e.wrap.width();d.height=e.wrap.height();e.wrap.stop(true).trigger("onReset").remove();delete c.position;f.inner.hide();f.wrap.css(d).animate(c,{duration:f.nextSpeed,easing:f.nextEasing,step:a.transitions.step,complete:function(){a._afterZoomIn();f.inner.fadeIn("fast")}})}}(jQuery,jQuery.fancybox));