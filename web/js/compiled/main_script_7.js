function escapeRegExp(a){if(undefined!==a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}}function ucall(e){var d=$("#auth_form"),c=$(".attention_box",d),b=(d.data("refresh"))?1:0,a={};if(c.length){c.remove()}if(e){$.getJSON("https://ulogin.ru/token.php?token="+e+"&host="+encodeURIComponent(location.hostname)+"&callback=?",function(f){a=$.parseJSON(f.toString());if(!a||a.error||a.verified_email!=1){d.prepend("<div class=attention_box>Невозможно авторизоваться</div>")}$.ajax({url:settingsJS.routes.social_auth+"?refresh="+b,type:"POST",data:a,dataType:"JSON",success:function(g){if(g.errors){d.prepend("<div class=attention_box>"+g.msg+"</div>")}else{if(g.route){location=g.route}else{location.reload()}}},error:function(){console.log("error")}})})}}$(function(){$(".mask-integer").inputmask({alias:"integer"});$(document).ajaxStart(function(){$("body").css("cursor","progress")}).ajaxStop(function(){$("body").css("cursor","default")});$(document).keydown(function(h){var g=null;h=h||window.e;if(h.ctrlKey){var f=(h.target||h.srcElement).tagName;if(f!=="INPUT"&&f!=="TEXTAREA"){switch(h.keyCode?h.keyCode:h.which?h.which:null){case 37:g=$("#PrevPage").attr("href");break;case 39:g=$("#NextPage").attr("href");break}if(g){location.href=g}}}});var b=$(".search-input").attr("id");$("input#"+b).on("select2-selecting",function(f){f.preventDefault()}).on("select2-focus",function(g){if($(".select2-input").attr("onkeydown")===undefined){$(".select2-input").attr("onkeydown","select2searchOnKeyDown(this, this.value, event)")}if($(".select2-input").attr("onkeyup")===undefined){$(".select2-input").attr("onkeyup","select2searchOnKeyUp(this, this.value, event)")}$("form#search-form .select2-chosen").text("");var h=$("#"+b).prop("placeholder");if(h!=="Поиск игрушек"){var f=setInterval(function(){if($(".searchdrop .select2-search input").val()===h){clearInterval(f)}else{$(".searchdrop .select2-search input").val(h).trigger("input")}},5)}}).on("select2-close",function(f){var g=$("#"+b).prop("placeholder");$("form#search-form .select2-chosen").text(g);$(".select2-count-of-result").remove();$(".searchdrop").removeClass("no-round-br")}).on("select2-loaded",function(f){$(".select2-count-of-result").remove();$(".searchdrop").addClass("no-round-br").append('<div class="select2-count-of-result"><span>Найдено '+declOfNum(f.items.total,["совпадение","совпадения","совпадений"])+"</span></div>");$(".select2-highlighted").removeClass("select2-highlighted")});$("#search-form button").on("click",function(g){g.preventDefault();var f=$(".searchdrop .select2-input").val()?$(".searchdrop .select2-input").val():$("input#"+b).val();if(f.length>2){$("input#"+b).select2("close");$("input#"+b).val(f);$("form#search-form .select2-chosen").text(f);$("form#search-form").submit()}return false});$(".search_tip .text_tgl").click(function(){var e=$(this).text();$("input#"+b).select2("open");$("form#search-form .select2-chosen").text("");$("input#"+b).prop("placeholder",e);$(".searchdrop .select2-search input").val(e).trigger("input")});$(document).ajaxSuccess(function(g,h,f){if(f.url.indexOf("ajax/search.json")!==-1){var e=$.parseJSON(h.responseText);if(e.total!==undefined&&e.total===0){$(".select2-count-of-result").remove();$(".searchdrop").removeClass("no-round-br")}}});$(".header_contacts_phone .text_tgl, .call_us_sidebox .text_tgl").on("click",function(){$(".header_contacts_dropdown").show()});$(".header_contacts_dropdown ul li").on("click",function(){var e=$(this).find(".text-phone").text();var f=$(this).find(".text-city").text();$(".text-phone-selected").text(e);$(".text-city-selected").text(f);$(".header_contacts_dropdown").hide();$(".header_contacts_dropdown ul li.selected").removeClass("selected");$(this).addClass("selected");setCookie("header_phone",$(this).attr("id"),{expires:3600*24*90})});if(getCookie("header_phone")!==undefined){$(".header_contacts_dropdown ul li#"+getCookie("header_phone")).trigger("click")}$(document).click(function(e){if(!$(e.target).closest(".header_contacts_phone").length&&!$(e.target).closest(".call_us_sidebox").length){$(".header_contacts_dropdown").hide();e.stopPropagation()}});$("#change-contragent-container").dialog({modal:true,width:"auto",height:"auto",autoOpen:$("#change-contragent-container").data("auto-open"),closeOnEscape:!$("#change-contragent-container").data("auto-open"),dialogClass:"change-contragent-dialog",show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},position:"center",open:function(e,f){if($("#change-contragent-container").data("auto-open")===true){$(".change-contragent-dialog .ui-dialog-titlebar-close").remove()}}});$(".btn-change-contragent").on("click",function(f){f.preventDefault();if($(this).hasClass("busy")){return}$(this).addClass("busy");$.ajax({type:"POST",url:$(".btn-change-contragent.with-url").data("url")}).done(function(e){if(undefined!==e.data){if(undefined!==e.data.url){location.href=e.data.url}else{if(undefined!==e.data.html){$("#change-contragent-container").html(e.data.html);$("#change-contragent-container").dialog("open")}}}$(".btn-change-contragent").removeClass("busy")});return false});$("#change-contragent-container").on("click","ul.change-contragent li span.text_tgl",function(f){if($(this).hasClass("busy")){return}if($(this).hasClass("contragent-selected")){$("#change-contragent-container").dialog("close");return}$(this).after('<span class="ajax-loading"></span>');$("ul.change-contragent li span.text_tgl").addClass("busy");$.ajax({url:$("ul.change-contragent").data("url"),data:{contragentId:$(this).data("id")},method:"POST",success:function(e){location.reload()}})});$("ul.flex").flexMenu({linkText:"Ещё",linkTitle:"Ещё",showOnHover:true});$(".flexMenu-popup li").each(function(){$span=$(this).find("span");$span.text($span.text());$(this).find("a").addClass("one_word")});var d;var c=false;$("body").mousemove(function(){if(!$("div.nav_cats:hover, .nav_submenu_cats_block:hover").length){c=false}});$("ul.nav_cats li.nav_cat, div.nav_cat_last, .nav_submenu_cats_block").on({mouseover:function(){if($(this).data("menu")!==undefined){var f=$(this).data("menu")}else{var f=$(this).data("submenu")}var e=$('li.nav_cat[data-menu="'+f+'"]');if(!$(e).hasClass("active")){e.find("a.nav_cat_link").addClass("hover")}if(!$(this).closest(".flexMenu-popup").length){if(!c){d=setTimeout(function(){c=true;$('.nav_submenu_cats_block[data-submenu="'+f+'"]').show()},500)}else{$('.nav_submenu_cats_block[data-submenu="'+f+'"]').show()}}},mouseout:function(){clearTimeout(d);if($(this).data("menu")!==undefined){var f=$(this).data("menu")}else{var f=$(this).data("submenu")}var e=$('li.nav_cat[data-menu="'+f+'"]');if(!$(e).hasClass("active")){e.find("a.nav_cat_link").removeClass("hover")}$(".nav_submenu_cats_block").hide()}});$("#show-all-payment-system").on("click",function(){if($(this).hasClass("isViewed")){$(this).removeClass("isViewed");$(".footer_payments li.thisViewed").fadeOut("fast")}else{$(this).addClass("isViewed");$(".footer_payments li.hidden").addClass("thisViewed").fadeIn("fast")}triggerText($(this))});var a='<div class="avaliability_expected_popup" style="top: -153px; left: 20px; bottom: auto;"><form method="post" class="report_instock"><ins class="modal_window_close"></ins><h4>Узнать о поступлении товара</h4><input class="text_input avaliability_expected_popup_input" type="email" name="email" placeholder="Ваш E-mail" required="required"><button class="common_button"><span>Отправить заявку</span></button></form></div>';$(".product").on("click",".modal_window_close",function(){$(this).closest(".avaliability_expected_popup").fadeOut(200,function(){$(this).remove()})});$(".report-instock").click(function(){var e=$(this).data("id");if(e){$(".modal_window_close").trigger("click");$(this).after(a);$(".avaliability_expected_popup").fadeIn(200).find("form").append('<input type="hidden" value="'+e+'" name="productId"/>')}});$(".product").on("click","form.report_instock button",function(h){var f=$(this).closest("form");var g={email:f.find('input[name="email"]').val(),productId:f.find('input[name="productId"]').val()};if(g.email.length&&g.productId.length){h.preventDefault();$.ajax({type:"POST",data:g,url:settingsJS.routes.core_product_subscribe_to_report}).done(function(e){if(e.error!==undefined){alertCustom("Ошибка!",e.error.join("<br>"),{buttons:{Ок:function(){$(this).dialog("close")}}})}else{if(e.success!==undefined){alertCustom("Сообщение",e.success.join("<br>"),{buttons:{Ок:function(){$(this).dialog("close")}}});$(".modal_window_close").trigger("click");f.find('input[name="email"]').val("")}}});return false}else{if(!g.email.length){$(this).closest("div").addClass("form_field_error")}if(!g.productId.length){location.reload()}}});$(".product").on("mouseover",".report-instock",function(){var f=$(this);var e=f.closest(".report-instock").data("id");if(e!==undefined&&f.attr("title")===undefined){$.ajax({type:"POST",data:{productId:e},url:settingsJS.routes.core_product_get_date_and_count_for_nearest_supply}).done(function(g){if(g.success!==undefined){f.attr("title",g.success)}})}})});function select2searchOnKeyUp(d,c,b){if(c.match(/[^0-9a-zA-Zа-яА-Я\ \-]/g)){c=c.replace(/[^0-9a-zA-Zа-яА-Я\ \-]/g,"");d.value=c}var a=$(".search-input").attr("id");$("input#"+a).prop("placeholder",c).val(c);$("input#"+a).val(c)}function select2searchOnKeyDown(f,e,c){var b=c.keyCode?c.keyCode:c.which;var a=String.fromCharCode(b);var d=[27,8,46,36,35,39,37];if(!($.inArray(b,d)>=0)&&((c.shiftKey&&b===189)||(b!==189&&!c.ctrlKey&&(c.shiftKey&&a.match(/[0-9]/g)||a.match(/[^0-9a-zA-Zа-яА-Я\ -]/g))))||a.match(/o|j|k|n/)){c.preventDefault()}if(!$(".select2-highlighted").length){switch(b){case 13:$("#search-form button").trigger("click");break;case 38:$(".select2-result:last").addClass("select2-highlighted");$(".searchdrop ul.select2-results").scrollTop($(".searchdrop ul.select2-results")[0].scrollHeight);break;case 40:$(".select2-result:first").addClass("select2-highlighted");break}}else{switch(b){case 13:select2searchOnClick($(".select2-highlighted").find("a")[0]);break}}}function select2searchOnClick(b){var a=$(".search-input").attr("id");$("input#"+a).select2("close");var c=$("#"+a).prop("placeholder");$("form#search-form .select2-chosen").text(c);location.href=b.href}function alertCustom(c,b,a){$("#alert-container").remove();$("body").append('<div id="alert-container" title="'+c+'">'+b+"</div>");a.modal=true;a.closeOnEscape=true;$("#alert-container").dialog(a)}function declOfNum(a,c,b){if(b===undefined){b=" "}cases=[2,0,1,1,1,2];return a+b+c[(a%100>4&&a%100<20)?2:cases[(a%10<5)?a%10:5]]}function triggerText(a){var b=a.text();a.text(a.data("trigger-text"));a.data("trigger-text",b)}(function(a){a.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",false)}})(jQuery);function number_format(d,b,k,c){var f,e,h,g,a;if(isNaN(b=Math.abs(b))){b=2}if(k===undefined){k=","}if(c===undefined){c=" "}f=parseInt(d=(+d||0).toFixed(b))+"";if((e=f.length)>3){e=e%3}else{e=0}a=(e?f.substr(0,e)+c:"");h=f.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+c);g=Math.abs(d-f).toFixed(b).replace(/-/,0).slice(2);return parseInt(g)?a+h+k+g:a+h}function setCookie(e,g,c){c=c||{};var b=c.expires;if(typeof b==="number"&&b){var i=new Date();i.setTime(i.getTime()+b*1000);b=c.expires=i}if(b&&b.toUTCString){c.expires=b.toUTCString()}g=encodeURIComponent(g);var a=e+"="+g;if(c.path===undefined){c.path="/"}for(var f in c){a+="; "+f;var h=c[f];if(h!==true){a+="="+h}}document.cookie=a}function getCookie(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):undefined}function deleteCookie(a){setCookie(a,"",{expires:-1})}function loadLoginFormByAjax(a){if(a===undefined){a="/login.html"}$.ajax({type:"POST",data:{modal:true},url:a}).done(function(b){$("body").append('<div title="Необходима авторизация" id="login-container"></div>');$("#login-container").hide().html(b).dialog({modal:true,width:"auto",height:"auto",autoOpen:true,show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},position:"center"})})}(function(a){a(function(){a(".modal_window_off").click(function(){var b=a(this),c=b.parents(".login_offer_box");c.slideUp();return false});a(".login.popup").click(function(){a(".modal_window").modal("show");return false});a(".restore").click(function(){a(".modal_window_body").toggleClass("hidden");return false});a(".modal_window .close").click(function(){var e=a(this),c=a("#modal_reset"),b=a(".modal_reset_success"),g=e.parents(".modal_window"),d=a(".modal_restore"),f=a(".modal_login");g.modal("hide");d.addClass("hidden");f.removeClass("hidden");if(b.length){b.remove();c.removeClass("hidden")}return false});a(".modal_window #auth_form").submit(function(){var c=a(this),b=a("#username_login",c),e=b.parent(".form_field"),d=c.data("refresh");errorBlock=b.siblings(".form_field_error_txt");if(errorBlock.length){errorBlock.remove();e.removeClass("form_field_error")}a.ajax({url:c.attr("action"),data:c.serialize(),method:c.attr("method"),success:function(f){if(!f.success){b.after('<div class="form_field_error_txt">'+f.message+"</div>");e.addClass("form_field_error")}else{if(f.url&&!d){window.location=f.url}else{location.reload()}}}});return false});a(".modal_window #modal_reset").submit(function(){var d=a(this),f=a(".modal_window"),c=a("#username",d),e=c.parent(".form_field"),b=c.siblings(".form_field_error_txt");if(b.length){b.remove();e.removeClass("form_field_error")}a.ajax({url:d.attr("action"),data:d.serialize(),method:d.attr("method"),success:function(g){if(g.success){d.addClass("hidden");d.after('<div class="modal_reset_success info_box">'+g.message+"</div>")}else{c.after('<div class="form_field_error_txt">'+g.message+"</div>");e.addClass("form_field_error")}}});return false})})})(jQuery);