function first(c){for(var b in c){return b}}var speedAnimation=200;$(function(){$("#color").change(function(){var n=$("#size :selected").val();var m=$("#color :selected").data("links-json");var l;if(undefined!==m){if(undefined!==m[n]){l=location.origin+m[n]}else{l=location.origin+m[first(m)]}location.href=l}});$("#frontend_pre_order_preOrder_phone").inputmask({mask:"+7 (999) 999-99-99[9]",greedy:false});$("#frontend_pre_order_preOrder_compositions_0_quantity").inputmask("integer");var j=$("#sizeMsgTpl").html();$("#size").change(function(){if($(this).hasClass("load")){$("#size").val($('#size option[data-current="this"]').val())}$(this).removeClass("load");var q=$("#size :selected").val();var n=$("#size :selected").text();var p=$("#color :selected").text();var m=$("#color :selected").data("links-json");var o=$(".product_photo_view img");if(undefined===m||undefined===m[q]){var l=new Array();$("#color option").each(function(){var r=$(this).data("links-json");if(undefined!==r&&undefined!==r[q]){l[l.length]=" - "+$(this).text()}});if(l.length){sizeMsg=j.replace(/%size%/g,n).replace(/%color%/g,p).replace(/%colors%/g,l.join(";<br>"));$("#sizeMsgTpl").html(sizeMsg).slideDown("fast",function(){if($(".side_col_pad .product_specs").length&&$(".side_col_pad .product_buy").length){k=$(".side_col_pad .product_specs").outerHeight(true)+$(".side_col_pad .product_buy").outerHeight(true)}i={cursor:"crosshair",imageCrossfade:false,zoomWindowPosition:1,zoomWindowHeight:(!k)?410:k,zoomWindowWidth:650,zoomWindowFadeIn:500,zoomWindowFadeOut:750,zoomWindowOffetx:110,loadingIcon:"http://www.elevateweb.co.uk/spinner.gif",borderSize:0,onZoomedImageLoaded:function(){$(".img-loader").stop(true,true,true).hide();$(".product_photo_view .loupe").stop(true,true,true).show()}};if(o.data("zoom-image")){$(".zoomContainer").remove();o.removeData("elevateZoom");o.elevateZoom(i)}})}$(".instock").removeClass("instock").addClass("not_instock");$(".button_cart").prop("disabled",true).fadeOut(100);$(".count-instock").hide()}else{if(undefined!==m[q]&&location.origin+m[q]!==location.href.replace(/#.+/,"")){}else{$(".button_cart").prop("disabled",false).fadeIn(100)}$("#sizeMsgTpl").slideUp("fast");$(".not_instock").removeClass("not_instock").addClass("instock");$(".count-instock").show()}}).trigger("change");$(".fancybox-button").fancybox({prevEffect:"fade",openEffect:"fade",closeEffect:"fade",nextEffect:"fade",transitionIn:"elastic",transitionOut:"elastic",iframe:{preload:false},nextMethod:"resizeIn"});var c={widthItem:$(".product_gallery_item").outerWidth(true),count:$(".product_gallery_item").size(),boundWidth:$(".product_gallery").width()};c.widthContainer=c.widthItem*c.count;$(".product_gallery_scroll").width(c.widthContainer);if(c.widthContainer>c.boundWidth){$(".product_gallery_nav.next").removeClass("disabled")}$(".product_gallery_nav").disableSelection();$(".product_gallery_nav.next").click(function(){var m=$(this);if(m.hasClass("disabled")||m.hasClass("busy")){return false}m.addClass("busy");var l=$(".product_gallery_scroll");l.animate({marginLeft:-c.widthItem+parseInt(l.css("margin-left"))},speedAnimation,"linear",function(){if($(".product_gallery_nav.prev").hasClass("disabled")){$(".product_gallery_nav.prev").removeClass("disabled")}if(Math.abs(parseInt(l.css("margin-left")))>=Math.abs(c.widthContainer-c.boundWidth)){m.addClass("disabled")}m.removeClass("busy")})});$(".product_gallery_nav.prev").click(function(){var m=$(this);if(m.hasClass("disabled")||m.hasClass("busy")){return false}m.addClass("busy");var l=$(".product_gallery_scroll");l.animate({marginLeft:c.widthItem+parseInt(l.css("margin-left"))},speedAnimation,"linear",function(){if($(".product_gallery_nav.next").hasClass("disabled")){$(".product_gallery_nav.next").removeClass("disabled")}if(parseInt(l.css("margin-left"))>=0){m.addClass("disabled")}m.removeClass("busy")})});var k;if($(".side_col_pad .product_specs").length&&$(".side_col_pad .product_buy").length){k=$(".side_col_pad .product_specs").outerHeight(true)+$(".side_col_pad .product_buy").outerHeight(true)}var i={cursor:"crosshair",imageCrossfade:false,zoomWindowPosition:1,zoomWindowHeight:(!k)?410:k,zoomWindowWidth:650,zoomWindowFadeIn:500,zoomWindowFadeOut:750,zoomWindowOffetx:110,loadingIcon:"http://www.elevateweb.co.uk/spinner.gif",borderSize:0,onZoomedImageLoaded:function(){$(".img-loader").stop(true,true,true).hide();$(".product_photo_view .loupe").stop(true,true,true).show()}};if($(".product_photo_view img").data("zoom-image")){$(".product_photo_view img").elevateZoom(i)}$("body").on("mouseover",".product_gallery_item",function(){var o=$(this),l=$(".product_photo_view .loupe"),n=$(".product_photo_view img"),q=$("img",o),m=410,p=o.data("src");if($(".side_col_pad .product_specs").length&&$(".side_col_pad .product_buy").length){m=$(".side_col_pad .product_specs").outerHeight(true)+$(".side_col_pad .product_buy").outerHeight(true);i.zoomWindowHeight=m}if(o.hasClass("small_video")){l.addClass("hidden");l.hide();return false}$(".product_gallery_item").removeClass("active");o.addClass("active");n.prop("src",p);$(".zoomContainer").remove();n.removeData("elevateZoom");if(q.data("zoom-image")){l.stop(true,true,true).fadeOut(200);$(".img-loader").stop(true,true,true).fadeIn(400);n.data("zoom-image",q.data("zoom-image"));n.elevateZoom(i)}else{l.hide()}});$(".product_gallery_item.active").trigger("mouseover");$(".zoom-photo span").click(function(){$(this).parent(".zoom-photo").prev(".product_photo_view").find("img").trigger("click")});$(".showcase_compact_nav").disableSelection();$(".showcase_nav").disableSelection();var b=new Array();var e=new Array();var d=new Array();$(".showcase_compact_box, .showcase_container").each(function(p){var s=$(this);var n=s.find(".products_grid_line");var r=n.find(".product");var m=s.find(".showcase_compact_nav.next").size()?s.find(".showcase_compact_nav.next"):s.find(".showcase_nav.next");var o=s.find(".showcase_compact_nav.prev").size()?s.find(".showcase_compact_nav.prev"):s.find(".showcase_nav.prev");var q=Math.round(n.width()/r.outerWidth());d[p]=232;if(s.hasClass("showcase_compact_box")){var l=s.find(".grid_container")}else{var l=s}l.find(".product").each(function(){$(this).find("img")[0].onload=function(){h=$(this).closest("div.product").outerHeight();if(h>d[p]){l.css("min-height",h+"px");l.find(".grid_container").css("min-height",h+"px")}}});b[p]=1;e[p]=q+b[p];if(r.size()>q){m.removeClass("disabled");r.each(function(t){if(t>(q-1)){$(this).hide()}})}m.click(function(){if(m.hasClass("disabled")||m.hasClass("busy")||(e[p]>=r.size()+1)){return false}m.addClass("busy");$right=n.find(".product:nth-child("+e[p]+")").css({position:"absolute",top:parseInt(r.css("margin-top")),left:parseInt(n.width())}).show();$right.animate({left:parseInt($right.css("left"))-r.outerWidth()},speedAnimation,"linear",function(){});$left=n.find(".product:nth-child("+b[p]+")").animate({marginLeft:-r.outerWidth()},speedAnimation,"linear",function(){if(o.hasClass("disabled")){o.removeClass("disabled")}if(e[p]>=r.size()+1){m.addClass("disabled")}$right.removeAttr("style");$(this).hide();m.removeClass("busy")});b[p]++;e[p]++});o.click(function(){if(o.hasClass("disabled")||o.hasClass("busy")||b[p]<=0){return false}o.addClass("busy");$left=n.find(".product:nth-child("+(b[p]-1)+")").css({marginLeft:-parseInt(r.outerWidth())}).show();$right=n.find(".product:nth-child("+(e[p]-1)+")").css({position:"absolute",top:parseInt(r.css("margin-top")),left:parseInt(r.outerWidth()*(q-1))}).show();$left.animate({marginLeft:0},speedAnimation,"linear",function(){});$right=n.find(".product:nth-child("+(e[p]-1)+")").animate({left:parseInt(n.width())},speedAnimation,"linear",function(){if(m.hasClass("disabled")){m.removeClass("disabled")}if((b[p]-1)<=0){o.addClass("disabled")}$left.removeAttr("style");$(this).hide();o.removeClass("busy")});b[p]--;e[p]--})});var f={add:{url:$("#update-favorite").data("add-url"),text:$("#update-favorite").data("add-text")},remove:{url:$("#update-favorite").data("remove-url"),text:$("#update-favorite").data("remove-text")},isInFavorite:$("#update-favorite").data("is-in-favorite"),isLogged:$("#update-favorite").data("is-logged")};if(f.isInFavorite){$("#update-favorite").text(f.remove.text).addClass("remove_from_faver")}else{$("#update-favorite").text(f.add.text)}$("#update-favorite").click(function(){if($(this).hasClass("busy")){return}$(this).addClass("busy");f.isInFavorite=$("#update-favorite").data("is-in-favorite");if(!f.isLogged){$(".modal_window").addClass("modal-in-center").modal("show");setCookie("add_in_favorite",f.add.url,{expires:3600*24});setCookie("redirect",document.URL,{expires:3600*24});$("#update-favorite").removeClass("busy");return}var l=f.isInFavorite?f.remove.url:f.add.url;var m=$(".ajax-result-favorites");m.children("div").slideUp("fast");$.ajax({type:"POST",url:l}).done(function(n){if(undefined!==n.success){$("#update-favorite").data("is-in-favorite",f.isInFavorite?0:1);$("#update-favorite").text(f.isInFavorite?f.add.text:f.remove.text);if(f.isInFavorite){$("#update-favorite").removeClass("remove_from_faver")}else{$("#update-favorite").addClass("remove_from_faver")}m.find(".ajax-success").html(n.success.join("<br>")).slideDown("fast")}if(undefined!==n.error){$("#update-favorite").data("is-in-favorite",f.isInFavorite?0:1);$("#update-favorite").text(f.isInFavorite?f.add.text:f.remove.text);m.find(".ajax-error").html(n.error.join("<br>")).slideDown("fast")}$("#update-favorite").removeClass("busy")})});if(getCookie("add_in_favorite")!==undefined){if(!f.isInFavorite){$('span[data-add-url="'+getCookie("add_in_favorite")+'"]').trigger("click")}deleteCookie("add_in_favorite")}var g={id:$("#update-cart").data("id"),url:$("#update-cart").data("url"),isInCart:$("#update-cart").data("is-in-cart"),isInCartText:$("#update-cart").data("is-in-cart-text")};var a=$.parseJSON(orderJsonString)||{};if($("#quantity-alternative").length){$("#quantity-alternative").on("change",function(){var l=parseInt($("#quantity-alternative").val());if(a!==null&&a.products!==undefined&&a.products[l]!==undefined){$(".ajax-result-cart").find(".ajax-success").html(g.isInCartText).slideDown("fast")}else{$(".ajax-result-cart").find(".ajax-success").slideUp("fast")}})}$("#update-cart").on("click",function(){if($(this).hasClass("disabled")){return}$(this).addClass("disabled");g.action="add";if($("#quantity-alternative").length){g.id=parseInt($("#quantity-alternative").val())}var l=$(".ajax-result-cart");l.children("div").slideUp("fast");$.ajax({type:"POST",data:{id:g.id,action:g.action},url:g.url}).done(function(m){if(undefined!==m.success){l.find(".ajax-success").html(m.success.join("<br>")).slideDown("fast");if(a!==null&&a.products!==undefined&&a.products[g.id]!==undefined){a.products[g.id]["quantity"]+=1}else{a.products=new Array();a.products[g.id]={id:g.id,quantity:1}}}if(undefined!==m.error){l.find(".ajax-error").html(m.error.join("<br>")).slideDown("fast")}if(undefined!==m.data){$(".header_usercart_count").text(m.data.total_quantity);$(".header_usercart_info").text(declOfNum(m.data.total_quantity,["товар","товара","товаров"])+", "+number_format(m.data.total_cost)+" "+$(".header_usercart_info").data("currency"))}$("#update-cart").removeClass("disabled")})});$("#pre_order_form").submit(function(){var p=$(this),m,n=$("#pre_order_total_cost"),o=$(".form_field_error_txt"),q=$("#byOrderMessage"),l=$("#buy-in-order");visitortime=new Date(),visitortimezone=-visitortime.getTimezoneOffset()/60;q.hide();if(o.length){o.each(function(r,s){var t=$(s);t.parents(".like_text_input_rounded_wr").removeClass("form_field_error");t.remove()})}$.ajax({type:"POST",data:p.serialize()+"&pre_order_form[visitortimezone]="+visitortimezone,url:settingsJS.routes.core_product_buy_by_order,success:function(s){if(s.result){q.show().attr("class","by-order-success-message").html(s.msg);if(s.cost){n.html(s.cost+"<span> руб.</span>")}}else{for(var r in s.errors){m=$("input."+r,p);m.parents(".like_text_input_rounded_wr").addClass("form_field_error");$('<div class="form_field_error_txt">'+s.errors[r]+"</div>").insertAfter(m)}}l.removeClass("disabled").removeAttr("disabled")},error:function(){m=$("input.quantity",p);m.parents(".like_text_input_rounded_wr").addClass("form_field_error");$('<div class="form_field_error_txt"> Не возможно просчитать </div>').insertAfter(m);l.removeClass("disabled").removeAttr("disabled")}});l.addClass("disabled").attr("disabled","disabled");return false});$("body").on("blur","#frontend_pre_order_preOrder_compositions_0_quantity",function(){var r=$(this),q,n=$("#pre_order_form"),u=$(".form_field_error_txt"),m=$("#byOrderMessage"),t=$("#pre_order_total_cost"),o=$("#frontend_pre_order_preOrder_compositions_0_product").val();if(u.length){u.each(function(v,w){var x=$(w);x.parents(".like_text_input_rounded_wr").removeClass("form_field_error");x.remove()})}var s=[],p={};p.product=o;p.quantity=r.val();s.push(p);var l={compositions:s};if(r.val()&&(!r.data("quantity")||r.data("quantity")!=r.val())){$.post(settingsJS.routes.core_pre_order_cost,l).done(function(w){if(w.data){t.html(w.data.print_cost);r.data("quantity",r.val())}else{if(w.errors){for(var v in w.errors){q=$("input."+v,n);q.parents(".like_text_input_rounded_wr").addClass("form_field_error");$('<div class="form_field_error_txt">'+w.errors[v]+"</div>").insertAfter(q)}}}}).fail(function(v){q=$("input.quantity",n);q.parents(".like_text_input_rounded_wr").addClass("form_field_error");$('<div class="form_field_error_txt"> Не возможно просчитать </div>').insertAfter(q)})}});$("body").on("change","#frontend_pre_order_contactList",function(){var r=$(this),m=r.parents("#pre_order_form"),s=$("input[id^='frontend_pre_order_preOrder_city']",m),p=$(".select2-container.city .select2-chosen",m),q=$(".select2-container.city.ajax-entity",m),n=$(".select2-choice",q),l=$("option:selected",r).data("contact");if(r.val()){for(var o in l){if(o=="city"){s.val(l[o].id);p.text(l[o].caption);n.removeClass("select2-default")}else{$("."+o,m).val(l[o])}}}else{$('select, textarea, input:not([type="hidden"])',m).each(function(t,u){var v=$(u);v.val("");if(v.hasClass("ajax-entity")){p.text("Город");n.addClass("select2-default");v.select2("val","")}})}})});(function(b,a){a.transitions.resizeIn=function(){var e=a.previous,f=a.current,d=e.wrap.stop(true).position(),c=b.extend({opacity:1},f.pos);d.width=e.wrap.width();d.height=e.wrap.height();e.wrap.stop(true).trigger("onReset").remove();delete c.position;f.inner.hide();f.wrap.css(d).animate(c,{duration:f.nextSpeed,easing:f.nextEasing,step:a.transitions.step,complete:function(){a._afterZoomIn();f.inner.fadeIn("fast")}})}}(jQuery,jQuery.fancybox));