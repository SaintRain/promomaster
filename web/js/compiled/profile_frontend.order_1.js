var speedAnimation=200;$(function(){$(".cart_product_qnt_input").inputmask({mask:9,repeat:3,greedy:false});$(".qnt_btn,.cart_product_tool,.group_switch,.type_switch").disableSelection();function c(g){if(g.hasClass("disabled")){return}var f=g.closest("tr");var h=f.find(".cart_product_qnt_input");var e=h.data("max");f.find(".increase").removeClass("disabled");f.find(".decrease").removeClass("disabled");d(g);g.addClass("disabled");if(g.data("action")==="setQuantity"){if(g.hasClass("decrease")){if(parseInt(h.val())-1>0){h.val(parseInt(h.val())-1);g.removeClass("disabled")}else{g.removeClass("disabled");return}}else{if(g.hasClass("increase")){if(parseInt(h.val())+1<=999&&e>=parseInt(h.val())+1){h.val(parseInt(h.val())+1)}else{g.removeClass("disabled");return}}}}if(h.val()>h.data("max")){alertCustom("Информация","Всего доступно на складе "+h.data("max")+" шт.",{buttons:{Ok:function(){h.val(h.data("max"));c(h);$(this).dialog("close")}}});$(".ui-dialog :button").focus();g.removeClass("disabled");$("#create-order").addClass("disabled");f.find(".increase").addClass("disabled");return}$("#create-order").addClass("disabled");$.ajax({type:"POST",data:{id:f.data("id"),action:g.data("action"),quantity:parseInt(h.val())},url:f.data("url")}).done(function(i){if(undefined!==i.error){alertCustom("Информация",i.error.join("<br>"),{buttons:{Ok:function(){$(this).dialog("close")}}});$(".ui-dialog :button").focus()}else{if(undefined!==i.success){$("#create-order").removeClass("disabled");if(g.data("action")==="remove"){g.closest("tr").fadeOut(100,function(){$(this).remove();if($("tr.cart_product").length===0){$(".cart_total,.cart_products_list").remove();$(".main_col_pad").html('<div class="info_box">Ваша корзина пуста</div>')}})}}}if(undefined!==i.data){$(".header_usercart_count").text(i.data.total_quantity);if(i.data.total_quantity>0){$(".header_usercart_info").text(declOfNum(i.data.total_quantity,["товар","товара","товаров"])+", "+number_format(i.data.total_cost)+" "+$(".header_usercart_info").data("currency"))}else{$(".header_usercart_info").text($(".header_usercart_info").data("empty-text"))}var l=i.data.composition;for(id in l){var k=$('tr[data-id="'+id+'"]');k.find(".composition_cost").text(number_format(l[id]["cost"]));k.find(".discountValue").text(l[id]["discountValue"]);if(l[id]["isDiscountValueInPercent"]){k.find(".discountValueInCurrency").text(number_format(l[id]["discountValueInMoney"]))}}$("#total_discount_summ").text(number_format(i.data.total_discount_summ));$("#total_cost").text(number_format(i.data.total_cost));var j=i.data.confines;if(j.canCreateOrder===false){$(".order_proceed").hide();$(".confines_min_sum").html(j.msg).show()}else{$(".order_proceed").show();$(".confines_min_sum").html("").hide()}}g.removeClass("disabled");if(g[0].tagName==="SPAN"){if(parseInt(h.val())>=e){g.addClass("disabled")}}if(parseInt(h.val())>=e){f.find(".increase").addClass("disabled");f.find(".decrease").removeClass("disabled")}})}$("#create-order").on("click",function(){if($(this).hasClass("disabled")){return}});$(".qnt_btn, .delete").on("click",function(){c($(this))});var b=0;$(".cart_product_qnt_input").on("focus",function(){val=$(this).val()});$(".cart_product_qnt_input").on("change keypress",function(g){if(((g.type==="change"&&$(this).val()!==b)&&$(".cart_product_qnt_input").focus())||(g.type==="keypress"&&(g.keyCode===13||g.which===13))){if($(".ui-dialog:visible").length===0){var f=d($(this));if(f){c($(this))}}if(g.type==="keypress"){b=$(this).val()}}});$("#create-order").on("click",function(){if($(this).hasClass("disabled")){return}var e=$(this).data("url");location.href=e});if($(".more_info_timer").length){var a=setInterval(function(){now=parseInt($(".more_info_timer").text());if(now===0){clearInterval(a);location.href=$(".more_info").attr("href")}else{$(".more_info_timer").text(now-1)}},1000)}$(".group_switch").on("click",function(){$(".group_switch").removeClass("active");$(".type_switch").removeClass("active");$(this).addClass("active");var e=$(this).data("tab");$(".type_switches").hide();if($('.type_switches[data-content="'+e+'"]').length){$(".order_payment_type.type_switcher").show();$('.type_switches[data-content="'+e+'"]').show()}else{$(".order_payment_type.type_switcher").hide()}$("#PaymentSystem").val($(this).data("val"));if($.inArray($(this).data("val"),["BankTransfer","PaymentOnDelivery","PlasticCardTerminal"])<0){$(".common_button span.text-trigger").text("Перейти к оплате...")}else{$(".common_button span.text-trigger").text("Оформить заказ")}});$(".type_switch").on("click",function(){$(".type_switch").removeClass("active");$(this).addClass("active");$("#PaymentSystem").val($(this).data("val"));if($.inArray($(this).data("val"),["BankTransfer","PaymentOnDelivery","PlasticCardTerminal"])<0){$(".common_button span.text-trigger").text("Перейти к оплате...")}else{$(".common_button span.text-trigger").text("Оформить заказ")}});$(".common_button").on("click",function(g){var f=$("#PaymentSystem");if(f.length&&!f.val().length){g.preventDefault();alertCustom("Ошибка!","Выберите способ оплаты",{buttons:{Ok:function(){$(this).dialog("close")}}});return false}});var d=function(h){var f=h.closest("tr"),i=$(".cart_product_qnt_input",f),e=$(".cart_product_name",f).text(),g=$(".delete.with_icon.text_tgl",f);if((parseInt(i.val())==0&&h.hasClass("cart_product_qnt_input"))||(h.data("action")==="setQuantity"&&(parseInt(i.val())==1||parseInt(i.val())==0)&&h.hasClass("decrease"))){alertCustom("Информация","Вы действительно хотите удалить из корзины "+e,{buttons:{"Да":function(){g.trigger("click");$(this).dialog("close")},"Нет":function(){i.val(1);$(this).dialog("close")}}});return false}return true}});